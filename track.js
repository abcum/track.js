/*! 
 * Copyright 2015 Abcum Ltd. 
 * Created 2015-03-04 03:33:39 GMT 
 */ 

!function(exports,global){global["true"]=exports;var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=Base64._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=this._keyStr.indexOf(a.charAt(j++)),f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i=Base64._utf8_decode(i)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b}};"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx,escapable,gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),window.OPA=function(){function a(){}return a.prototype.lat=null,a.prototype.lng=null,a.prototype.geo=!1,a.prototype.auto=!0,a.prototype.start=null,a.prototype.domain="https://itsy.li",a.prototype.conf=function(){var a=window.OP||{};"undefined"!=typeof a.geo&&(this.geo=a.geo),"undefined"!=typeof a.auto&&(this.auto=a.auto)},a.prototype.init=function(){var a=this;if(a.conf(),a.cors(),a.find(),a.load(),a.start=window.location.href,this.auto&&window.history){var b=window.history.pushState;window.history.pushState=function(){return b&&b.apply(window.history,arguments),a.auto?a.track("page"):null}}if(this.auto&&window.history){var c=window.history.replaceState;window.history.replaceState=function(){return c&&c.apply(window.history,arguments),a.auto?a.track("page"):null}}if(this.auto&&window.history){var d=window.onpopstate;window.onpopstate=function(){return d&&d.apply(window,arguments),a.start!=window.location.href?a.auto?a.track("page"):null:void 0}}if(this.auto&&"onhashchange"in window){var e=window.onhashchange;window.onhashchange=function(){return e&&e.apply(window,arguments),a.auto?a.track("hash"):null}}},a.prototype.load=function(){return window.OPAID&&this.identify(window.OPAID),this.query("opa")&&this.identify(this.query("opa")),this.query("l")?this.track("page",{l:this.query("l"),referer:document.referrer}):this.query("e")?this.track("page",{e:this.query("e"),referer:document.referrer}):this.auto?this.track("page",{referer:document.referrer}):void 0},a.prototype.send=function(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1),c.send(JSON.stringify(b))},a.prototype.time=function(){return(new Date).getTime()},a.prototype.hash=function(){for(var a=document.getElementsByTagName("*"),b=0;b<a.length;b++)if(a[b].getAttribute("data-opa"))return a[b].getAttribute("data-opa")},a.prototype.cors=function(){var a=new Image(1,1);a.src=this.domain+"/uniq/"+this.uniq()+"/"+this.time()+".gif"},a.prototype.track=function(a,b){var c={};c.name=a,c.lat=this.lat,c.lng=this.lng,c.hash=this.hash(),c.sess=this.uniq(),c.href=window.location.href,c.sw=window.screen.width,c.sh=window.screen.height,c.ww=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth,c.wh=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight,b&&(c.extra=b),this.send(this.domain+"/track",c)},a.prototype.identify=function(a){if(a){var b={};b.name=-1!=a.indexOf("@")?Base64.encode(a):a,b.sess=this.uniq(),this.send(this.domain+"/identify",b)}},a.prototype.uniq=function(){var a="opa",b=Math.random().toString(36).slice(2),c=this.getCookie(a),d=this.getStorage(a);return d&&!c&&this.setCookie(a,d),c&&!d&&this.setStorage(a,c),c||d||!b||this.setCookie(a,b),c||d||!b||this.setStorage(a,b),c||d||b},a.prototype.find=function(){this.geo&&(this.lat=this.getStorage("lat"),this.lng=this.getStorage("lng"),this.lat&&this.lng||this.geocode())},a.prototype.geocode=function(){if(window.navigator.geolocation){var a=this;window.navigator.geolocation.getCurrentPosition(function(b){a.geocoded(b)},function(){},{enableHighAccuracy:!0,maximumAge:31536e6,timeout:6e4})}},a.prototype.geocoded=function(a){this.lat=a.coords.latitude,this.lng=a.coords.longitude,this.setStorage("lat",this.lat),this.setStorage("lng",this.lng)},a.prototype.getCookie=function(){var a="; "+document.cookie,b=a.split("; "+name+"=");return 2==b.length?b.pop().split(";").shift():void 0},a.prototype.setCookie=function(a,b){var c=new Date;c.setTime(c.getTime()+15768e7),document.cookie=a+"="+b+"; expires="+c.toGMTString()+"; path=/"},a.prototype.getStorage=function(a){return"localStorage"in window?window.localStorage[a]:void 0},a.prototype.setStorage=function(a,b){"localStorage"in window&&(window.localStorage[a]="object"==typeof b?JSON.stringify(b):b)},a.prototype.query=function(a){for(var b=window.location.search.substring(1).split("&"),c=0;c<b.length;c++){var d=b[c].split("=");if(decodeURIComponent(d[0])==a)return decodeURIComponent(d[1])}},new a}(),OPA.init()}({},function(){return this}());